-- Auto Collect Script with GUI + Minimize Toggle + Restore Fix (Fully Working)

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")

local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local HumanoidRootPart = Character:WaitForChild("HumanoidRootPart")

local collecting = false
local TOGGLE_KEY = Enum.KeyCode.P
local pickupCounter = 0
local minimized = false

local VALID_PARENT_NAMES = {
    ["box_"] = true,
    ["potion_"] = true
}

local function showBigMessage(message)
    StarterGui:SetCore("SendNotification", {
        Title = "Auto Collector",
        Text = message,
        Duration = 3
    })
end

local function systemChat(message)
    StarterGui:SetCore("ChatMakeSystemMessage", {
        Text = "[AutoCollector] " .. message,
        Color = Color3.fromRGB(0, 255, 0),
        Font = Enum.Font.SourceSansBold,
        FontSize = Enum.FontSize.Size24
    })
end

local function touchPart(part)
    local originalCFrame = HumanoidRootPart.CFrame
    HumanoidRootPart.CFrame = part.CFrame + Vector3.new(0, 2, 0)
    wait(0.15)
    HumanoidRootPart.CFrame = originalCFrame
end

local function isValidPickupObject(obj)
    if obj:IsA("BasePart") and obj:FindFirstChildOfClass("TouchTransmitter") then
        local parent = obj.Parent
        if parent and typeof(parent.Name) == "string" then
            for prefix, _ in pairs(VALID_PARENT_NAMES) do
                if parent.Name:lower():find(prefix) then
                    return true
                end
            end
        end
    end
    return false
end

local function collectAllTouchables()
    for _, obj in ipairs(workspace:GetDescendants()) do
        if isValidPickupObject(obj) then
            touchPart(obj)
            pickupCounter += 1
            systemChat("Collected: " .. pickupCounter .. " item(s)")
        end
    end
end

workspace.DescendantAdded:Connect(function(desc)
    if not collecting then return end
    if isValidPickupObject(desc) then
        wait(0.25)
        touchPart(desc)
        pickupCounter += 1
        systemChat("Collected: " .. pickupCounter .. " item(s)")
    end
end)

-- GUI Setup
local gui = Instance.new("ScreenGui")
gui.Name = "AutoCollectorGUI"
gui.ResetOnSpawn = false
gui.Parent = game:GetService("CoreGui")

local frame = Instance.new("Frame")
frame.Name = "MainFrame"
frame.Size = UDim2.new(0, 200, 0, 100)
frame.Position = UDim2.new(0, 20, 0.5, -50)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Parent = gui

local stroke = Instance.new("UIStroke")
stroke.Color = Color3.fromRGB(255, 50, 50)
stroke.Thickness = 2
stroke.Parent = frame

local toggleBtn = Instance.new("TextButton")
toggleBtn.Name = "ToggleButton"
toggleBtn.Size = UDim2.new(1, -20, 0, 30)
toggleBtn.Position = UDim2.new(0, 10, 0, 10)
toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
toggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
toggleBtn.Font = Enum.Font.GothamSemibold
toggleBtn.TextSize = 16
toggleBtn.Text = "Auto Collect: OFF"
toggleBtn.Parent = frame

local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Name = "MinimizeButton"
minimizeBtn.Size = UDim2.new(1, -20, 0, 30)
minimizeBtn.Position = UDim2.new(0, 10, 0, 50)
minimizeBtn.BackgroundColor3 = Color3.fromRGB(50, 0, 0)
minimizeBtn.TextColor3 = Color3.new(1, 1, 1)
minimizeBtn.Font = Enum.Font.GothamBlack
minimizeBtn.TextSize = 16
minimizeBtn.Text = "Minimize"
minimizeBtn.Parent = frame

local function toggleCollect()
    collecting = not collecting
    toggleBtn.Text = collecting and "Auto Collect: ON" or "Auto Collect: OFF"
    if collecting then
        pickupCounter = 0
        showBigMessage("Auto Grab Activated!")
        systemChat("Auto Grab Enabled")
        coroutine.wrap(function()
            while collecting do
                collectAllTouchables()
                wait(5)
            end
        end)()
    else
        showBigMessage("Auto Grab Deactivated.")
        systemChat("Auto Grab Disabled. Total collected: " .. pickupCounter)
    end
end

toggleBtn.MouseButton1Click:Connect(toggleCollect)

local function restoreUI()
    frame:ClearAllChildren()
    frame.Size = UDim2.new(0, 200, 0, 100)
    frame.BackgroundTransparency = 0

    local strokeRestore = Instance.new("UIStroke")
    strokeRestore.Color = Color3.fromRGB(255, 50, 50)
    strokeRestore.Thickness = 2
    strokeRestore.Parent = frame

    local newToggle = toggleBtn:Clone()
    newToggle.Parent = frame
    newToggle.MouseButton1Click:Connect(toggleCollect)

    local newMinimize = minimizeBtn:Clone()
    newMinimize.Parent = frame
    newMinimize.MouseButton1Click:Connect(function()
        minimized = true
        frame:ClearAllChildren()
        frame.Size = UDim2.new(0, 40, 0, 40)
        frame.BackgroundTransparency = 1

        local circle = Instance.new("Frame")
        circle.Size = UDim2.new(1, 0, 1, 0)
        circle.BackgroundColor3 = Color3.fromRGB(40, 0, 0)
        circle.BackgroundTransparency = 0.2
        circle.BorderSizePixel = 0
        circle.Position = UDim2.new(0, 0, 0, 0)
        circle.ZIndex = 0
        circle.Parent = frame

        local uiCorner = Instance.new("UICorner")
        uiCorner.CornerRadius = UDim.new(1, 0)
        uiCorner.Parent = circle

        local smallBtn = Instance.new("TextButton")
        smallBtn.Size = UDim2.new(1, 0, 1, 0)
        smallBtn.BackgroundTransparency = 1
        smallBtn.TextColor3 = Color3.fromRGB(255, 50, 50)
        smallBtn.Font = Enum.Font.GothamBold
        smallBtn.TextSize = 20
        smallBtn.Text = "A"
        smallBtn.ZIndex = 1
        smallBtn.Parent = frame

        smallBtn.MouseButton1Click:Connect(function()
            minimized = false
            restoreUI()
        end)
    end)
end

minimizeBtn.MouseButton1Click:Connect(function()
    minimized = true
    frame:ClearAllChildren()
    frame.Size = UDim2.new(0, 40, 0, 40)
    frame.BackgroundTransparency = 1

    local circle = Instance.new("Frame")
    circle.Size = UDim2.new(1, 0, 1, 0)
    circle.BackgroundColor3 = Color3.fromRGB(40, 0, 0)
    circle.BackgroundTransparency = 0.2
    circle.BorderSizePixel = 0
    circle.Position = UDim2.new(0, 0, 0, 0)
    circle.ZIndex = 0
    circle.Parent = frame

    local uiCorner = Instance.new("UICorner")
    uiCorner.CornerRadius = UDim.new(1, 0)
    uiCorner.Parent = circle

    local smallBtn = Instance.new("TextButton")
    smallBtn.Size = UDim2.new(1, 0, 1, 0)
    smallBtn.BackgroundTransparency = 1
    smallBtn.TextColor3 = Color3.fromRGB(255, 50, 50)
    smallBtn.Font = Enum.Font.GothamBold
    smallBtn.TextSize = 20
    smallBtn.Text = "A"
    smallBtn.ZIndex = 1
    smallBtn.Parent = frame

    smallBtn.MouseButton1Click:Connect(function()
        minimized = false
        restoreUI()
    end)
end)

UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    if input.KeyCode == TOGGLE_KEY then
        toggleCollect()
    end
end)
